/*
 * Licensed to Systerel under one or more contributor license
 * agreements. See the NOTICE file distributed with this work
 * for additional information regarding copyright ownership.
 * Systerel licenses this file to you under the Apache
 * License, Version 2.0 (the "License"); you may not use this
 * file except in compliance with the License. You may obtain
 * a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */

#include "check_crypto_certificates.h"

#include <stdlib.h>

#include <check.h>

#include "hexlify.h"

// test_server.der
const char* SRV_CRT =
    "308203f8308202e0a003020102020200fa300d06092a864886f70d01010b05003061310b3009060355040613024652310f300d060355040813"
    "064672616e63653111300f060355040a1308537973746572656c312e302c0603550403132553324f504320556e697420546573742043657274"
    "6966696361746520417574686f726974793020170d3138313030323137333535355a180f32313138303930383137333535355a305e310b3009"
    "060355040613024652310f300d060355040813064672616e63653111300f060355040a1308537973746572656c312b30290603550403132253"
    "324f504320556e697420546573742053657276657220436572746966696361746530820122300d06092a864886f70d01010105000382010f00"
    "3082010a0282010100c40d1828296bf480dd95871226d2f6e28e95b99230c4f896f1e50b337f673215c320262d865378f4d7520933b3c94a0f"
    "8389bf8fffe9f4225cc86a6a971f5d71ed6a691055da3d244b0063d22f5a2d88e1c2f6d806ef6756152020fb680440d590844397189302645b"
    "a94218141f93e309e89705943576b8f41b03a0ffecaa14b03747a78ccaea1f87bc749d33950b931b494cb4ebdff6a56351884c8dcb3068f335"
    "75e27f268508f84c2664340337c2fb55ce51938c45be9851836668724eae76f33a2455705b2308d16d2c90908520deb28e4df9ffdb680285e3"
    "3befe4c6c2e6828b17a1915dff7f6523518a4c8074361a0be68890a1a372f044e8d6a6af0b0203010001a381ba3081b7301d0603551d0e0416"
    "0414913657b2da9b5847da8eb16fa93dc65817b14cdb301f0603551d230418301680146c5b7a23d12080c0773e808283364948f77ba6c6300f"
    "0603551d130101ff040530030101ff300b0603551d0f04040302010630290603551d1104223020861375726e3a53324f50433a6c6f63616c68"
    "6f737482096c6f63616c686f7374302c06096086480186f842010d041f161d4f70656e53534c2047656e657261746564204365727469666963"
    "617465300d06092a864886f70d01010b0500038201010079ddbc419e017ab37f0b4a9bcc5caf932bb6a2b41eac1ddc55e5971ef4d8f05c3efb"
    "964ad8f21337042c0895bc451fd789a43dfd58e7fa153e920d6a20a5276cfc2924e9bc6bf49f99d7e4d3fbd3fab9a8c1f5780102c939a64d0d"
    "a0a9036e1dd1ebabf09b764c494e6dc43bb7b28628010f871e74be025ca73ace00b244ae26c9f8cfa4b040d5377586610aebb009b6bcaf9b0b"
    "6d9c2b934b9969f08aab6adb5b7c05fedbb34776f2d38281bb0d20d0d0bb850d2c138667bce0e72f85b3cf5c37c8fede33b6137ac816923733"
    "ed19b8e13a0f7132cde8b6445752cb693762a9f3eae15c6690320199a4c0e2dc3ba42d0abf7f020368ff70d9b1efbf927f56aa";

const char* SRV_CRT_THUMB = "465399b879e4df70f4d38db275afe97dfda78ea0";

// test_ca.der
const char* CA_CRT =
    "308203a73082028fa003020102020900a7ca2900ba6efbd7300d06092a864886f70d01010b05003061310b3009060355040613024652310f30"
    "0d060355040813064672616e63653111300f060355040a1308537973746572656c312e302c0603550403132553324f504320556e6974205465"
    "737420436572746966696361746520417574686f726974793020170d3138313030323137333535335a180f3231313830393038313733353533"
    "5a3061310b3009060355040613024652310f300d060355040813064672616e63653111300f060355040a1308537973746572656c312e302c06"
    "03550403132553324f504320556e6974205465737420436572746966696361746520417574686f7269747930820122300d06092a864886f70d"
    "01010105000382010f003082010a0282010100b7f976733091310f9150ee22c2d8a2e1f1b75026a9a0c21de6c278dc159efd2e6d5342b84dde"
    "57f1627df351ff91038ab0149b3a50131b325150bd0ebe248bf1c14cfb749d030015e9a0c4b6b44a48dc773c1d47c499610368e954ac4b8456"
    "9689ff5d869a287c302b7b0db8312376f9c031388a517ecb52e7768b37fa86d3c0c64e0affad31aec1e885bde95a9e65d9816aff410ef30888"
    "1c89f43a19739af8fbdac0a11a42d7fb7adc1ecba35b7c61e3f3d6a316685a054873995fa302b078119942323f07e30981db41630af91cdcb1"
    "4343daf78b701d3ca59f71adfe224d2713349689adf3e600eff3187d89eb32856f1a012a681d7a36c706cc1259fe130203010001a360305e30"
    "1d0603551d0e041604146c5b7a23d12080c0773e808283364948f77ba6c6301f0603551d230418301680146c5b7a23d12080c0773e80828336"
    "4948f77ba6c6300f0603551d130101ff040530030101ff300b0603551d0f040403020106300d06092a864886f70d01010b05000382010100ab"
    "d97e43b1e7f74b4f1dd348c8fba0d320aa50ab60fd3496dd2e83f684b2a13bb8ea7dd0f7fc1db2104ed74a15ee54d0a815dd267e730b98484a"
    "0ed7601227951781ff8587b632bf64e1dc048306d823ac41cb7714114b05cf3e29f604647de814de29938e5c6e440faffb5ca947839058aca0"
    "1204be0d6124d06a36c4dd5059d9e552d0e359a9213363984c7201d229242aabd4f53519184006ae336d6e45e4c5da4d8b49e096384ebaf477"
    "c45e55a19ef15ba62d297f2b5cd8b8a78de2e4f1662461fccff6decc3ab9a1383b81e9d649cc8dbdd91cde893aa1b0ffa94bec885399ab7a3a"
    "9eea9c92e7e195c0b8072594b066bb5a0aae29a7ba384b2d8e711a";

SOPC_Certificate* SOPC_UnhexlifyCertificate(const char* hex_data)
{
    size_t der_len = strlen(hex_data) / 2;
    uint8_t* der_data = calloc(der_len, sizeof(uint8_t));
    ck_assert_ptr_nonnull(der_data);

    ck_assert(unhexlify(hex_data, der_data, der_len) == (int) der_len);
    SOPC_Certificate* crt = NULL;
    ck_assert(der_len <= SIZE_MAX);
    ck_assert_uint_eq(SOPC_STATUS_OK, SOPC_KeyManager_Certificate_CreateFromDER(der_data, (uint32_t) der_len, &crt));
    free(der_data);

    return crt;
}
